@page "/questions"

@using Questions.Data
@inject QuestionsService QuestionsService

<h1>List Screen</h1>

<p>This component demonstrates fetching data from a service.</p>

@if (QuestionList == null)
{
  <p><em>Loading...</em></p>
}
else
{
  <nav aria-label="Page navigation">
    <ul class="pagination">
      <li class="btn btn-primary @((isFirstPage? "disabled" : ""))   " @onclick=@(async ()=>await NavigateToPage("previous"))  href="#" disabled=@isFirstPage>Previous</li>
      <li class="page-item disabled"><a class="page-link">Page @curPage</a></li>
      <li class="btn btn-primary @((isLastPage? "disabled" : ""))" @onclick=@(async ()=>await NavigateToPage("next"))  href="#" disabled=@isLastPage>Next</li>
    </ul>
  </nav>



  <table class="table">
    <thead>
      <tr>
        <th> </th>
        <th> </th>
        <th>Question</th>
        <th>Published at</th>
      </tr>
    </thead>
    <tbody>
      @foreach (var question in QuestionList)
      {
        <tr>
          <td>@question.Id </td>
          <td><img src="@question.Thumb_Url" height="50" width="50" /></td>
          <td>@question.QuestionText</td>
          <td>@question.Published_At</td>
        </tr>
      }

    </tbody>
  </table>


}

@code {




  public IEnumerable<Question> QuestionList { get; set; } = new List<Question>();
  private QuestionParameters _productParameters = new QuestionParameters();

  private int questionsLimit = 10;

  #region Pagination
  bool isLastPage = false;
  bool isFirstPage = true;
  int curPage = 1;
  int pagerSize;
  int pageSize;
  int startPage;
  #endregion

  protected override async Task OnInitializedAsync()
  {
    _productParameters.Limit = questionsLimit;
    _productParameters.Offset = 0;
    _productParameters.Filter = "";

    QuestionList = await QuestionsService.GetQuestions(_productParameters);
    isLastPage = false;
  }


  public async Task NavigateToPage(string direction)
  {

    if (direction.Equals("previous"))
    {
      if (curPage == 1) return;

      curPage--;
      isLastPage = false;
    }
    else
    {
      if (isLastPage) return;
      curPage++; isFirstPage = false;
    }


    _productParameters.Limit = questionsLimit;
    _productParameters.Offset = curPage == 1 ? 0 : questionsLimit * (curPage - 1);

    QuestionList = await QuestionsService.GetQuestions(_productParameters);
    if (QuestionList.Count() < questionsLimit) isLastPage = true;
    if (curPage == 1) isFirstPage = true;

    StateHasChanged();
  }

}
